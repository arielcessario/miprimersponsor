(function(){angular.module("miPrimerSponsor",["oc.lazyLoad","ngRoute","ngAnimate","angular-storage","angular-jwt","duScroll","auth0","acUtils","acUsuarios","acProyectos","acUploads","acProgressBar","acContacts","acAnimate"]).config(["$routeProvider","authProvider",function(c,d){d.init({domain:"ac-desarrollos.auth0.com",clientID:"su5JUmdUk52EWhfK5xxZJtnw6W3IK9c1",loginUrl:"/ingreso"});c.otherwise("/main");c.when("/main",{templateUrl:"main/main.html",controller:"MainController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(e){return e.load("main/main.js")}]}});c.when("/administracion",{templateUrl:"administracion/administracion.html",controller:"AdministracionController",data:{requiresLogin:true},resolve:{loadMyCtrl:["$ocLazyLoad",function(e){return e.load("administracion/administracion.js")}]}});c.when("/nuevo_usuario",{templateUrl:"nuevo_usuario/nuevo_usuario.html",controller:"NuevoUsuarioController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(e){return e.load("nuevo_usuario/nuevo_usuario.js")}]}});c.when("/ingreso",{templateUrl:"ingreso/ingreso.html",controller:"IngresoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(e){return e.load("ingreso/ingreso.js")}]}});c.when("/proyecto/:id",{templateUrl:"proyecto/proyecto.html",controller:"ProyectoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(e){return e.load("proyecto/proyecto.js")}]}});c.when("/resultados",{templateUrl:"resultados/resultados.html",controller:"ResultadoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(e){return e.load("resultados/resultados.js")}]}})}]).run(function(c,d,f,g,e){e.hookEvents();c.$on("$routeChangeStart",function(h,i){if(i&&i.data&&i.data.requiresLogin){if(!d.get(window.appName)){h.preventDefault();g.path("/ingreso")}}})}).controller("AppController",a).service("AppService",b);a.$inject=["UserService","$location","AppService","CategoryService","$timeout","$document","$scope","DonationService","AcUtils","ContactsService","ProyectService","$window"];function a(l,e,g,c,r,u,m,q,i,h,t,j){var p=this;p.hideLoader=true;p.menu_mobile_open=false;p.user=l.getFromToken();p.isLogged=false;p.welcomeTo="";p.categorias=[];p.textProyecto="";p.proyecto={};p.moved=false;p.logout=o;p.goToAnchor=k;p.filterByCategory=n;p.filterByText=d;p.donacionRapida=f;p.goToDetalle=s;if(p.user!=false){p.isLogged=true;p.welcomeTo=p.user.data.nombre}c.get(function(v){p.categorias=v});angular.element(j).bind("scroll",function(){p.moved=window.pageYOffset!=0;m.$apply()});function s(w,v){g.origen=v;e.path("/proyecto/"+w)}g.listen(function(){p.user=l.getFromToken();if(p.user!=false){p.isLogged=true;p.welcomeTo=p.user.data.nombre}else{e.path("/ingreso");p.isLogged=false;p.welcomeTo="";p.user=false}});function k(v){e.path("/main");r(function(){var w=1000;var y=50;var x=angular.element(document.getElementById(v));u.scrollToElement(x,y,w)},20)}m.$watch("appCtrl.textProyecto",function(w,v){if(w!=v&&w!=undefined&&!g.vieneDeCat){d()}});function d(){g.type="t";g.search=p.textProyecto;e.path("/resultados");r(function(){p.textProyecto=""},1000)}function n(v){g.vieneDeCat=true;g.type="c";g.search=v;p.textProyecto="";e.path("/resultados");g.broadcastCategoria()}function o(){l.logout(function(v){e.path("/ingreso");p.isLogged=false;p.welcomeTo="";p.user=false})}function f(w,x,y){if(!p.user){i.showMessage("error","Debe estar registrado e ingresado para poder realizar una donación.");e.path("/ingreso");return}if(isNaN(w)&&w.indexOf("searchDon")>-1){w=parseFloat(document.getElementById(w).value)}if(w<1||isNaN(w)){i.showMessage("error","La donación debe ser mayor a 0");w=0;return}var v={proyecto_id:x,donador_id:p.user.data.id,valor:w,status:0};q.create(v,function(z){if(z>0){i.showMessage("success","Donación realizada con éxito, por favor aguarde la confirmación de la misma.");t.getByParams("proyecto_id",""+x,"true",function(A){h.sendMail(p.user.data.mail,window.mailAdmins,"MPE","Existe un nuevo cambio para aprobar","NUEVA DONACIÓN - Proyecto "+((p.proyecto.nombre==undefined)?y:p.proyecto.nombre),function(B){console.log(B)});h.sendMail(window.mailAdmin,[{mail:p.user.data.mail}],"MPE","Su donación ha sido realizada, por favor realice la transferencia correspondiente y espere a su aprobación.","NUEVA DONACIÓN - Proyecto "+((p.proyecto.nombre==undefined)?y:p.proyecto.nombre),function(B){console.log(B)})})}else{i.showMessage("error","Hubo un problema con la donación, por favor contacte al administrador")}})}}b.$inject=["$rootScope"];function b(c){this.vieneDeCat=false;this.search="";this.type="c";this.origen="/main";this.listen=function(d){c.$on("miprimersponsorradio",d)};this.broadcast=function(){c.$broadcast("miprimersponsorradio")};this.listenCategoria=function(d){c.$on("miprimersponsorradiocategoria",d)};this.broadcastCategoria=function(){c.$broadcast("miprimersponsorradiocategoria")}}})();WebFontConfig={google:{families:["Droid+Sans:400,700:latin"]}};(function(){var a=document.createElement("script");a.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";a.type="text/javascript";a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();