(function(){angular.module("miPrimerSponsor",["oc.lazyLoad","ngRoute","ngAnimate","angular-storage","angular-jwt","duScroll","auth0","acUtils","acUsuarios","acProyectos","acUploads","acProgressBar","acContacts","acAnimate"]).config(["$routeProvider","authProvider",function(e,f){f.init({domain:"ac-desarrollos.auth0.com",clientID:"su5JUmdUk52EWhfK5xxZJtnw6W3IK9c1",loginUrl:"/ingreso"});e.otherwise("/main");e.when("/main",{templateUrl:"main/main.html",controller:"MainController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(g){return g.load("main/main.js")}]}});e.when("/administracion",{templateUrl:"administracion/administracion.html",controller:"AdministracionController",data:{requiresLogin:true},resolve:{loadMyCtrl:["$ocLazyLoad",function(g){return g.load("administracion/administracion.js")}]}});e.when("/nuevo_usuario",{templateUrl:"nuevo_usuario/nuevo_usuario.html",controller:"NuevoUsuarioController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(g){return g.load("nuevo_usuario/nuevo_usuario.js")}]}});e.when("/ingreso",{templateUrl:"ingreso/ingreso.html",controller:"IngresoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(g){return g.load("ingreso/ingreso.js")}]}});e.when("/proyecto/:id",{templateUrl:"proyecto/proyecto.html",controller:"ProyectoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(g){return g.load("proyecto/proyecto.js")}]}});e.when("/resultados",{templateUrl:"resultados/resultados.html",controller:"ResultadoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(g){return g.load("resultados/resultados.js")}]}});e.when("/faq",{templateUrl:"faq/faq.html",controller:"FaqController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(g){return g.load("faq/faq.js")}]}});e.when("/legales",{templateUrl:"legales/legales.html",controller:"LegalController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(g){return g.load("legales/legales.js")}]}});e.when("/conozcanos",{templateUrl:"conozcanos/conozcanos.html",controller:"ConozcanosController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(g){return g.load("conozcanos/conozcanos.js")}]}})}]).run(function(e,f,h,i,g){g.hookEvents();e.$on("$routeChangeStart",function(j,k){if(k&&k.data&&k.data.requiresLogin){if(!f.get(window.appName)){j.preventDefault();i.path("/ingreso")}}})}).controller("AppController",b).service("AppService",d).factory("MPService",a).directive("twitter",c);b.$inject=["UserService","$location","AppService","CategoryService","$timeout","$document","$scope","DonationService","AcUtils","ContactsService","ProyectService","$window","MPService"];function b(q,i,l,f,w,z,r,v,n,m,y,o,e){var u=this;u.hideLoader=true;u.menu_mobile_open=false;u.user=q.getFromToken();u.isLogged=false;u.welcomeTo="";u.categorias=[];u.textProyecto="";u.proyecto={};u.moved=false;u.link="";u.donacion={};u.logout=t;u.goToAnchor=p;u.filterByCategory=s;u.filterByText=g;u.donacionRapida=k;u.goToDetalle=x;m.facebookInit();j(document,"script","twitter-wjs");function j(E,A,F){var D,B=E.getElementsByTagName(A)[0],C=/^http:/.test(E.location)?"http":"https";if(!E.getElementById(F)){D=E.createElement(A);D.id=F;D.src=C+"://platform.twitter.com/widgets.js";B.parentNode.insertBefore(D,B)}}if(u.user!=false){u.isLogged=true;u.welcomeTo=u.user.data.nombre}f.get(function(A){u.categorias=A});angular.element(o).bind("scroll",function(){u.moved=window.pageYOffset!=0;r.$apply()});function x(B,A){l.origen=A;i.path("/proyecto/"+B)}l.listen(function(){u.user=q.getFromToken();if(u.user!=false){u.isLogged=true;u.welcomeTo=u.user.data.nombre}else{i.path("/ingreso");u.isLogged=false;u.welcomeTo="";u.user=false}});function p(A){i.path("/main");w(function(){var B=1000;var D=50;var C=angular.element(document.getElementById(A));z.scrollToElement(C,D,B)},20)}r.$watch("appCtrl.textProyecto",function(B,A){if(B!=A&&B!=undefined&&!l.vieneDeCat){g()}});function g(){l.type="t";l.search=u.textProyecto;i.path("/resultados");w(function(){u.textProyecto=""},1000)}function s(A){l.vieneDeCat=true;l.type="c";l.search=A;u.textProyecto="";i.path("/resultados");l.broadcastCategoria()}function t(){q.logout(function(A){i.path("/ingreso");u.isLogged=false;u.welcomeTo="";u.user=false})}function k(A,B,C){console.log(A);if(!u.user){n.showMessage("error","Debe estar registrado e ingresado para poder realizar una donación.");i.path("/ingreso");return}if(A!=undefined&&isNaN(A)&&A.indexOf("searchDon")>-1){A=parseFloat(document.getElementById(A).value)}if(A<1||isNaN(A)){n.showMessage("error","La donación debe ser mayor a 0");A=0;return}u.donacion={proyecto_id:B,donador_id:u.user.data.id,valor:A,status:0};u.item={titulo:C,categoria:"Mi Primer Sponsor",cantidad:1,precio:A,mail:u.user.data.mail};e.pay(u.item,function(D){console.log(D);u.link=D.response.sandbox_init_point;$MPC.openCheckout({url:u.link,mode:"modal",onreturn:h})})}function h(A){if(A.collection_status=="approved"){console.log("Pago acreditado")}else{if(A.collection_status=="pending"){n.showMessage("error","El usuario no completó el pago");return}else{if(A.collection_status=="in_process"){n.showMessage("error","El pago está siendo revisado");return}else{if(A.collection_status=="rejected"){n.showMessage("error","El pago fué rechazado, el usuario puede intentar nuevamente el pago");return}else{if(A.collection_status==null){n.showMessage("error","El usuario no completó el proceso de pago, no se ha generado ningún pago");return}}}}}v.create(u.donacion,function(B){if(B>0){n.showMessage("success","Donación realizada con éxito, por favor aguarde la confirmación de la misma.");y.getByParams("proyecto_id",""+proyecto_id,"true",function(C){m.sendMail(u.user.data.mail,window.mailAdmins,"MPE","Existe un nuevo cambio para aprobar","NUEVA DONACIÓN - Proyecto "+((u.proyecto.nombre==undefined)?proyecto_nombre:u.proyecto.nombre),function(D){console.log(D)});m.sendMail(window.mailAdmin,[{mail:u.user.data.mail}],"MPE","Su donación ha sido realizada, por favor realice la transferencia correspondiente y espere a su aprobación.","NUEVA DONACIÓN - Proyecto "+((u.proyecto.nombre==undefined)?proyecto_nombre:u.proyecto.nombre),function(D){console.log(D)})})}else{n.showMessage("error","Hubo un problema con la donación, por favor contacte al administrador")}})}}a.$inject=["$http"];function a(g){var e={};e.pay=f;return e;function f(h,i){return g.get("ac-mp.php?function=pay&item="+JSON.stringify(h)).success(function(j){i(j)}).error(function(j){console.log(j)})}}d.$inject=["$rootScope"];function d(e){this.vieneDeCat=false;this.search="";this.type="c";this.origen="/main";this.listen=function(f){e.$on("miprimersponsorradio",f)};this.broadcast=function(){e.$broadcast("miprimersponsorradio")};this.listenCategoria=function(f){e.$on("miprimersponsorradiocategoria",f)};this.broadcastCategoria=function(){e.$broadcast("miprimersponsorradiocategoria")}}function c(){return{link:function(g,f,e){setTimeout(function(){twttr.widgets.createShareButton(e.url,f[0],function(h){},{count:"none",text:e.text})})}}}})();WebFontConfig={google:{families:["Droid+Sans:400,700:latin"]}};(function(){var a=document.createElement("script");a.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";a.type="text/javascript";a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();