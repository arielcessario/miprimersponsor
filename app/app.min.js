(function(){angular.module("miPrimerSponsor",["oc.lazyLoad","ngRoute","ngAnimate","angular-storage","angular-jwt","duScroll","auth0","acUtils","acPaginacion","acUsuarios","acProyectos","acUploads","acProgressBar","acContacts","acAnimate","acHelper"]).config(["$routeProvider","authProvider",function(f,g){g.init({domain:"ac-desarrollos.auth0.com",clientID:"su5JUmdUk52EWhfK5xxZJtnw6W3IK9c1",loginUrl:"/ingreso"});f.otherwise("/main");f.when("/main",{templateUrl:"main/main.html",controller:"MainController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("main/main.js")}]}});f.when("/administracion",{templateUrl:"administracion/administracion.html",controller:"AdministracionController",data:{requiresLogin:true},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("administracion/administracion.js")}]}});f.when("/nuevo_usuario",{templateUrl:"nuevo_usuario/nuevo_usuario.html",controller:"NuevoUsuarioController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("nuevo_usuario/nuevo_usuario.js")}]}});f.when("/ingreso",{templateUrl:"ingreso/ingreso.html",controller:"IngresoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("ingreso/ingreso.js")}]}});f.when("/proyecto/:id",{templateUrl:"proyecto/proyecto.html",controller:"ProyectoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("proyecto/proyecto.js")}]}});f.when("/resultados",{templateUrl:"resultados/resultados.html",controller:"ResultadoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("resultados/resultados.js")}]}});f.when("/faq",{templateUrl:"faq/faq.html",controller:"FaqController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("faq/faq.js")}]}});f.when("/legales",{templateUrl:"legales/legales.html",controller:"LegalController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("legales/legales.js")}]}});f.when("/conozcanos",{templateUrl:"conozcanos/conozcanos.html",controller:"ConozcanosController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("conozcanos/conozcanos.js")}]}});f.when("/contacto",{templateUrl:"contacto/contacto.html",controller:"ContactoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(h){return h.load("contacto/contacto.js")}]}})}]).run(function(f,g,i,j,h){h.hookEvents();f.$on("$routeChangeStart",function(k,l){if(l&&l.data&&l.data.requiresLogin){if(!g.get(window.appName)){k.preventDefault();j.path("/ingreso")}}})}).controller("AppController",c).service("AppService",e).factory("MPService",b).directive("twitter",d).directive("facebook",a);c.$inject=["UserService","$location","AppService","CategoryService","$timeout","$document","$scope","DonationService","AcUtils","ContactsService","ProyectService","$window","MPService","HelperService"];function c(s,k,m,g,y,B,t,x,o,n,A,q,f,j){var w=this;w.hideLoader=true;w.menu_mobile_open=false;w.user=s.getFromToken();w.isLogged=false;w.welcomeTo="";w.categorias=[];w.textProyecto="";w.proyecto={};w.moved=false;w.link="";w.donacion={};w.proyecto_id=0;w.proyecto_nombre="";w.logout=v;w.goToAnchor=r;w.filterByCategory=u;w.filterByText=h;w.donacionRapida=l;w.goToDetalle=z;w.getComision=p;n.facebookInit();if(w.user!=false){w.isLogged=true;w.welcomeTo=w.user.data.nombre}function p(C){return Math.floor(C*0.18)}g.get(function(C){w.categorias=C});angular.element(q).bind("scroll",function(){w.moved=window.pageYOffset!=0;t.$apply()});function z(E,C,D){if(event.target.tagName.toUpperCase()=="INPUT"||event.target.tagName.toUpperCase()=="BUTTON"){return}m.origen=C;k.path("/proyecto/"+E)}m.listen(function(){w.user=s.getFromToken();if(w.user!=false){w.isLogged=true;w.welcomeTo=w.user.data.nombre}else{k.path("/ingreso");w.isLogged=false;w.welcomeTo="";w.user=false}});function r(C){k.path("/main");y(function(){var D=1000;var F=50;var E=angular.element(document.getElementById(C));B.scrollToElement(E,F,D)},20)}t.$watch("appCtrl.textProyecto",function(D,C){if(D!=C&&D!=undefined&&!m.vieneDeCat){h()}});function h(){m.type="t";m.search=w.textProyecto;k.path("/resultados");y(function(){w.textProyecto=""},1000)}function u(C){m.vieneDeCat=true;m.type="c";m.search=C;w.textProyecto="";k.path("/resultados");m.broadcastCategoria()}function v(){s.logout(function(C){k.path("/ingreso");w.isLogged=false;w.welcomeTo="";w.user=false})}function l(C,D,E){console.log(C);if(!w.user){o.showMessage("error","Debe estar registrado e ingresado para poder realizar una donación.");k.path("/ingreso");return}if(C!=undefined&&isNaN(C)&&C.indexOf("searchDon")>-1){C=parseFloat(document.getElementById(C).value)}if(C<1||isNaN(C)){o.showMessage("error","La donación debe ser mayor a 0");C=0;return}w.donacion={proyecto_id:D,donador_id:w.user.data.id,valor:C,status:0};w.item={titulo:E,categoria:"Mi Primer Sponsor",cantidad:1,precio:C,mail:w.user.data.mail};f.pay(w.item,function(F){console.log(F);w.link=F.response.sandbox_init_point;w.proyecto_id=D;w.proyecto_nombre=E;$MPC.openCheckout({url:w.link,mode:"modal",onreturn:i})})}function i(C){var D={donacion:w.donacion,item:w.item};console.log(D);j.create(D).then(function(E){console.log(E)});x.create(w.donacion,function(E){if(E>0){w.donacion.donacion_id=E;w.donacion.status=1;x.update(w.donacion,function(F){o.showMessage("success","Donación realizada con éxito, muchas gracias.");A.getByParams("proyecto_id",""+w.proyecto_id,"true",function(G){n.sendMail(w.user.data.mail,window.mailAdmins,"MPE","Donación Realizada","NUEVA DONACIÓN - Proyecto "+((w.proyecto.nombre==undefined)?w.proyecto_nombre:w.proyecto.nombre),function(H){console.log(H)});n.sendMail(window.mailAdmin,[{mail:w.user.data.mail}],"MPE","Su donación ha sido realizada, por favor realice la transferencia correspondiente y espere a su aprobación.","NUEVA DONACIÓN - Proyecto "+((w.proyecto.nombre==undefined)?w.proyecto_nombre:w.proyecto.nombre),function(H){console.log(H)})})})}else{o.showMessage("error","Hubo un problema con la donación, por favor contacte al administrador")}})}}b.$inject=["$http"];function b(h){var f={};f.pay=g;return f;function g(i,j){return h.get("ac-mp.php?function=pay&item="+JSON.stringify(i)).success(function(k){j(k)}).error(function(k){console.log(k)})}}e.$inject=["$rootScope"];function e(f){this.vieneDeCat=false;this.search="";this.type="c";this.origen="/main";this.listen=function(g){f.$on("miprimersponsorradio",g)};this.broadcast=function(){f.$broadcast("miprimersponsorradio")};this.listenCategoria=function(g){f.$on("miprimersponsorradiocategoria",g)};this.broadcastCategoria=function(){f.$broadcast("miprimersponsorradiocategoria")}}d.$inject=["$timeout"];function d(f){return{scope:{url:"="},controller:function(j,i,g){var k=this;h();function h(){if(j.url==undefined){f(h,1000)}else{twttr.widgets.createShareButton("http://miprimersponsor.com/#/proyecto/"+j.url,i[0],function(l){},{count:"none",text:g.text})}}}}}a.$inject=["$window","$timeout"];function a(g,f){return{restrict:"A",scope:{proyecto:"="},template:'<div class="fb-share-button main-button-face" style="height: 30px; width: 30px;" data-layout="button_count" data-mobile-iframe="true" data-href="http://miprimersponsor.com/#/proyecto/{{proyecto}}/"></div>',link:function(k,j,i,l){k.$watch(function(){return !!g.FB},function(m){if(m){h()}});function h(){if(k.proyecto==undefined){f(h,1000)}else{g.FB.XFBML.parse(j.parent()[0])}}}}}})();WebFontConfig={google:{families:["Droid+Sans:400,700:latin"]}};(function(){var a=document.createElement("script");a.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";a.type="text/javascript";a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();