(function(){angular.module("miPrimerSponsor",["oc.lazyLoad","ngRoute","ngAnimate","angular-storage","angular-jwt","duScroll","auth0","acUtils","acUsuarios","acProyectos","acUploads","acProgressBar","acContacts","acAnimate"]).config(["$routeProvider","authProvider",function(d,e){e.init({domain:"ac-desarrollos.auth0.com",clientID:"su5JUmdUk52EWhfK5xxZJtnw6W3IK9c1",loginUrl:"/ingreso"});d.otherwise("/main");d.when("/main",{templateUrl:"main/main.html",controller:"MainController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(f){return f.load("main/main.js")}]}});d.when("/administracion",{templateUrl:"administracion/administracion.html",controller:"AdministracionController",data:{requiresLogin:true},resolve:{loadMyCtrl:["$ocLazyLoad",function(f){return f.load("administracion/administracion.js")}]}});d.when("/nuevo_usuario",{templateUrl:"nuevo_usuario/nuevo_usuario.html",controller:"NuevoUsuarioController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(f){return f.load("nuevo_usuario/nuevo_usuario.js")}]}});d.when("/ingreso",{templateUrl:"ingreso/ingreso.html",controller:"IngresoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(f){return f.load("ingreso/ingreso.js")}]}});d.when("/proyecto/:id",{templateUrl:"proyecto/proyecto.html",controller:"ProyectoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(f){return f.load("proyecto/proyecto.js")}]}});d.when("/resultados",{templateUrl:"resultados/resultados.html",controller:"ResultadoController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(f){return f.load("resultados/resultados.js")}]}});d.when("/faq",{templateUrl:"faq/faq.html",controller:"FaqController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(f){return f.load("faq/faq.js")}]}});d.when("/legales",{templateUrl:"legales/legales.html",controller:"LegalController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(f){return f.load("legales/legales.js")}]}});d.when("/conozcanos",{templateUrl:"conozcanos/conozcanos.html",controller:"ConozcanosController",data:{requiresLogin:false},resolve:{loadMyCtrl:["$ocLazyLoad",function(f){return f.load("conozcanos/conozcanos.js")}]}})}]).run(function(d,e,g,h,f){f.hookEvents();d.$on("$routeChangeStart",function(i,j){if(j&&j.data&&j.data.requiresLogin){if(!e.get(window.appName)){i.preventDefault();h.path("/ingreso")}}})}).controller("AppController",b).service("AppService",c).factory("MPService",a);b.$inject=["UserService","$location","AppService","CategoryService","$timeout","$document","$scope","DonationService","AcUtils","ContactsService","ProyectService","$window","MPService"];function b(o,h,j,e,u,x,p,t,l,k,w,m,d){var s=this;s.hideLoader=true;s.menu_mobile_open=false;s.user=o.getFromToken();s.isLogged=false;s.welcomeTo="";s.categorias=[];s.textProyecto="";s.proyecto={};s.moved=false;s.link="";s.donacion={};s.logout=r;s.goToAnchor=n;s.filterByCategory=q;s.filterByText=f;s.donacionRapida=i;s.goToDetalle=v;k.facebookInit();if(s.user!=false){s.isLogged=true;s.welcomeTo=s.user.data.nombre}e.get(function(y){s.categorias=y});angular.element(m).bind("scroll",function(){s.moved=window.pageYOffset!=0;p.$apply()});function v(z,y){j.origen=y;h.path("/proyecto/"+z)}j.listen(function(){s.user=o.getFromToken();if(s.user!=false){s.isLogged=true;s.welcomeTo=s.user.data.nombre}else{h.path("/ingreso");s.isLogged=false;s.welcomeTo="";s.user=false}});function n(y){h.path("/main");u(function(){var z=1000;var B=50;var A=angular.element(document.getElementById(y));x.scrollToElement(A,B,z)},20)}p.$watch("appCtrl.textProyecto",function(z,y){if(z!=y&&z!=undefined&&!j.vieneDeCat){f()}});function f(){j.type="t";j.search=s.textProyecto;h.path("/resultados");u(function(){s.textProyecto=""},1000)}function q(y){j.vieneDeCat=true;j.type="c";j.search=y;s.textProyecto="";h.path("/resultados");j.broadcastCategoria()}function r(){o.logout(function(y){h.path("/ingreso");s.isLogged=false;s.welcomeTo="";s.user=false})}function i(y,z,A){console.log(y);if(!s.user){l.showMessage("error","Debe estar registrado e ingresado para poder realizar una donación.");h.path("/ingreso");return}if(y!=undefined&&isNaN(y)&&y.indexOf("searchDon")>-1){y=parseFloat(document.getElementById(y).value)}if(y<1||isNaN(y)){l.showMessage("error","La donación debe ser mayor a 0");y=0;return}s.donacion={proyecto_id:z,donador_id:s.user.data.id,valor:y,status:0};s.item={titulo:A,categoria:"Mi Primer Sponsor",cantidad:1,precio:y,mail:s.user.data.mail};d.pay(s.item,function(B){console.log(B);s.link=B.response.sandbox_init_point;$MPC.openCheckout({url:s.link,mode:"modal",onreturn:g})})}function g(y){if(y.collection_status=="approved"){console.log("Pago acreditado")}else{if(y.collection_status=="pending"){l.showMessage("error","El usuario no completó el pago");return}else{if(y.collection_status=="in_process"){l.showMessage("error","El pago está siendo revisado");return}else{if(y.collection_status=="rejected"){l.showMessage("error","El pago fué rechazado, el usuario puede intentar nuevamente el pago");return}else{if(y.collection_status==null){l.showMessage("error","El usuario no completó el proceso de pago, no se ha generado ningún pago");return}}}}}t.create(s.donacion,function(z){if(z>0){l.showMessage("success","Donación realizada con éxito, por favor aguarde la confirmación de la misma.");w.getByParams("proyecto_id",""+proyecto_id,"true",function(A){k.sendMail(s.user.data.mail,window.mailAdmins,"MPE","Existe un nuevo cambio para aprobar","NUEVA DONACIÓN - Proyecto "+((s.proyecto.nombre==undefined)?proyecto_nombre:s.proyecto.nombre),function(B){console.log(B)});k.sendMail(window.mailAdmin,[{mail:s.user.data.mail}],"MPE","Su donación ha sido realizada, por favor realice la transferencia correspondiente y espere a su aprobación.","NUEVA DONACIÓN - Proyecto "+((s.proyecto.nombre==undefined)?proyecto_nombre:s.proyecto.nombre),function(B){console.log(B)})})}else{l.showMessage("error","Hubo un problema con la donación, por favor contacte al administrador")}})}}a.$inject=["$http"];function a(f){var d={};d.pay=e;return d;function e(g,h){return f.get("ac-mp.php?function=pay&item="+JSON.stringify(g)).success(function(i){h(i)}).error(function(i){console.log(i)})}}c.$inject=["$rootScope"];function c(d){this.vieneDeCat=false;this.search="";this.type="c";this.origen="/main";this.listen=function(e){d.$on("miprimersponsorradio",e)};this.broadcast=function(){d.$broadcast("miprimersponsorradio")};this.listenCategoria=function(e){d.$on("miprimersponsorradiocategoria",e)};this.broadcastCategoria=function(){d.$broadcast("miprimersponsorradiocategoria")}}})();WebFontConfig={google:{families:["Droid+Sans:400,700:latin"]}};(function(){var a=document.createElement("script");a.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";a.type="text/javascript";a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();