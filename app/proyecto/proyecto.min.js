(function(){var a=document.getElementsByTagName("script");var c=a[a.length-1].src;angular.module("miprimersponsor.proyecto",["ngRoute"]).controller("ProyectoController",b);b.$inject=["UserService","DonationService","ProyectService","$routeParams","CommentService","AcUtils","$location","ContactsService"];function b(j,f,k,m,o,g,i,l){var d=this;d.proyectos=[];d.proyecto={};d.donacion_cantidad=0;d.id=m.id;d.user=j.getFromToken();d.comentario={};d.comentarios=[];d.donacion_rapida_valor=0;d.donacionRapida=e;d.comentar=n;d.back=h;k.getByParams("proyecto_id",""+d.id,"true",function(p){d.proyecto=p[0];d.proyecto=angular.copy(p[0]);d.proyecto.porc=Math.round(d.proyecto.total_donado*100/d.proyecto.costo_inicial);d.proyecto.faltan=(new Date(new Date(d.proyecto.fecha_fin)-new Date())).getDate();o.get(d.proyecto.proyecto_id,function(q){d.comentarios=q})});function e(q,r){if(!d.user){i.path("/ingreso");return}if(q<0){g.showMessage("error","La donación debe ser mayor a 0");d.donacion_rapida_valor=0;return}var p={proyecto_id:r,donador_id:d.user.data.id,valor:q,status:0};f.create(p,function(s){if(s>0){g.showMessage("success","Donación realizada con éxito, por favor aguarde la confirmación de la misma.");l.sendMail(d.user.data.mail,[{mail:"arielcessario@gmail.com"},{mail:"mmaneff@gmail.com"}],"MPE","Existe un nuevo cambio para aprobar","NUEVA DONACIÓN - Proyecto "+d.proyecto.nombre,function(t){console.log(t)});l.sendMail(d.user.data.mail,[{mail:d.user.data.mail}],"MPE","Su donación ha sido realizada, por favor realice la transferencia correspondiente y espere a su aprobación.","NUEVA DONACIÓN - Proyecto "+d.proyecto.nombre,function(t){console.log(t)})}else{g.showMessage("error","Hubo un problema con la donación, por favor contacte al administrador")}})}function n(){if(!d.user||d.user.data.id==undefined){g.showMessage("erro","Debe estar registrado para poder realizar comentarios");return}if(d.comentario.detalles==undefined||d.comentario.detalles.trim()==""){g.validations("proyecto-comentario-nuevo","El comentario no debe estar vacío");return}d.comentario.proyecto_id=d.proyecto.proyecto_id;d.comentario.titulo="";d.comentario.parent_id=0;d.comentario.creador_id=d.user.data.id;d.comentario.votos_up=0;d.comentario.votos_down=0;o.create(d.comentario,function(p){o.get(d.proyecto.proyecto_id,function(q){d.comentario.detalles="";d.comentarios=q})})}function h(){i.path("/main")}}})();