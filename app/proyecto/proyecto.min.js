(function(){var a=document.getElementsByTagName("script");var c=a[a.length-1].src;angular.module("miprimersponsor.proyecto",["ngRoute"]).controller("ProyectoController",b);b.$inject=["UserService","DonationService","ProyectService","$routeParams","CommentService","AcUtils","$location","ContactsService","AppService","ProyectVars"];function b(l,f,m,o,q,g,j,n,h,e){var d=this;d.proyectos=[];d.proyecto={};d.donacion_cantidad=0;d.id=o.id;d.user=l.getFromToken();d.comentario={};d.comentarios=[];d.donacion_rapida_valor=0;d.proyecto_similar_01={};d.proyecto_similar_02={};d.proyecto_similar_03={};d.vals=[{val:"Donar",amount:-1},{val:"$10",amount:10},{val:"$25",amount:25},{val:"$50",amount:50},{val:"$75",amount:75},{val:"$100",amount:100},{val:"$200",amount:200},{val:"$300",amount:300},{val:"$400",amount:400}];d.comentar=p;d.borrarComentario=k;d.back=i;e.activos=true;m.getByParams("proyecto_id",""+d.id,"true",function(r){d.proyecto=r[0];d.foto_selected=(d.proyecto.fotos[0]==undefined)?"no_image.png":d.proyecto.fotos[0].nombre;d.proyecto=angular.copy(r[0]);d.proyecto.porc=Math.round(d.proyecto.total_donado*100/d.proyecto.costo_inicial);d.proyecto.faltan=(new Date(new Date(d.proyecto.fecha_fin)-new Date())).getDate();q.get(d.proyecto.proyecto_id,function(s){if(s.length>0){d.comentarios=s}});m.getByParams("categoria_id",""+d.proyecto.categoria_id,"true",function(s){d.proyecto_similar_01=s[0];d.proyecto_similar_02=s[1];d.proyecto_similar_03=s[2];if(d.proyecto_similar_01!=undefined){d.proyecto_similar_01=angular.copy(s[0]);d.proyecto_similar_01.porc=Math.round(d.proyecto_similar_01.total_donado*100/d.proyecto_similar_01.costo_inicial);d.proyecto_similar_01.faltan=(new Date(new Date(d.proyecto_similar_01.fecha_fin)-new Date())).getDate()}if(d.proyecto_similar_02!=undefined){d.proyecto_similar_02=s[1];d.proyecto_similar_02.porc=Math.round(d.proyecto_similar_02.total_donado*100/d.proyecto_similar_02.costo_inicial);d.proyecto_similar_02.faltan=(new Date(new Date(d.proyecto_similar_02.fecha_fin)-new Date())).getDate()}if(d.proyecto_similar_03!=undefined){d.proyecto_similar_03=s[2];d.proyecto_similar_03.porc=Math.round(d.proyecto_similar_03.total_donado*100/d.proyecto_similar_03.costo_inicial);d.proyecto_similar_03.faltan=(new Date(new Date(d.proyecto_similar_03.fecha_fin)-new Date())).getDate()}})});function p(){if(!d.user||d.user.data.id==undefined){g.showMessage("erro","Debe estar registrado para poder realizar comentarios");return}if(d.comentario.detalles==undefined||d.comentario.detalles.trim()==""){g.validations("proyecto-comentario-nuevo","El comentario no debe estar vac√≠o");return}d.comentario.proyecto_id=d.proyecto.proyecto_id;d.comentario.titulo="";d.comentario.parent_id=0;d.comentario.creador_id=d.user.data.id;d.comentario.votos_up=0;d.comentario.votos_down=0;q.create(d.comentario,function(r){q.get(d.proyecto.proyecto_id,function(s){d.comentario.detalles="";d.comentarios=s})})}function k(r){q.remove(r,function(s){q.get(d.proyecto.proyecto_id,function(t){d.comentario.detalles="";d.comentarios=t})})}function i(){j.path(h.origen)}}})();