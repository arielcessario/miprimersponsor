(function(){var a=document.getElementsByTagName("script");var b=a[a.length-1].src;angular.module("miprimersponsor.administracion",["ngRoute"]).controller("AdministracionController",c).service("AdministracionService",d);c.$inject=["UserService","AcUtils","ProyectService","$location","UploadService","UploadVars","$scope","DonationService","DonationVars","CategoryService","AdministracionService","AcUtilsGlobals","ContactsService","$timeout"];function c(N,e,i,G,o,v,m,p,w,B,l,g,L,E){var q=this;q.screen=l.screen;q.usuarios=[];q.usuario={usuario_id:-1};q.user=N.getFromToken();q.proyecto={proyecto_id:-1,status:"1",en_slider:"0"};q.proyectos=[];q.showJustificaciones=false;q.foto_01="";q.foto_02="";q.foto_03="";q.foto_04="";q.donaciones_entregadas=[];q.donaciones_obtenidas=[];q.cambios=[];q.padres=[];q.categoria={};q.proyecto_categoria=-1;q.donaciones=[];q.foto_01="no_image.png";q.foto_02="no_image.png";q.foto_03="no_image.png";q.foto_04="no_image.png";q.validation=true;q.modificarUsuario=x;q.resetUsuario=k;q.saveUsuario=n;q.removeUsuario=K;q.updateUsuario=j;q.modificarProyecto=f;q.resetProyecto=C;q.removeProyecto=s;q.createProyecto=F;q.createCambio=H;q.updateFotoProyecto=D;q.selectCambio=A;q.confirmarCambio=u;q.negarCambio=I;q.modificarCategoria=r;q.saveCategoria=J;q.removeCategoria=z;q.resetCategoria=y;q.aprobarDonacion=h;q.subirComprobante=M;if(N.getFromToken()==false){G.path("/ingreso")}m.$watch("administracionCtrl.screen",function(P,O){if(P=="administracion/datos.html"){if(q.user.data!=undefined&&q.user.data.rol=="0"){N.getByParams("marcado","0","true",function(Q){q.usuarios=Q;q.usuario.rol_id="1"})}else{q.usuario=N.getLogged()}}if(P=="administracion/patrocinadores.html"||P=="administracion/aportes.html"){w.clearCache=true;q.donaciones_entregadas=[];q.donaciones_obtenidas=[];p.get(q.user.data.id,function(R){for(var Q=0;Q<R.length;Q++){if(R[Q].donador_id==q.user.data.id){q.donaciones_entregadas.push(R[Q])}else{q.donaciones_obtenidas.push(R[Q])}}})}if(P=="administracion/proyectos.html"){B.get(function(Q){q.categorias=Q;q.proyecto_categoria=Q[0].categoria_id});if(q.user.data.rol==0){i.get(function(R){if(R.length>0){for(var Q=0;Q<R.length;Q++){R[Q].costo_inicial=parseFloat(R[Q].costo_inicial);R[Q].total_donado=parseFloat(R[Q].total_donado);R[Q].fecha_inicio=new Date(R[Q].fecha_inicio);R[Q].fecha_fin=new Date(R[Q].fecha_fin);R[Q].status=""+R[Q].status}q.proyectos=R}})}else{i.getByParams("usuario_id",""+q.user.data.id,"true",function(R){if(R.length>0){for(var Q=0;Q<R.length;Q++){R[Q].costo_inicial=parseFloat(R[Q].costo_inicial);R[Q].total_donado=parseFloat(R[Q].total_donado);R[Q].fecha_inicio=new Date(R[Q].fecha_inicio);R[Q].fecha_fin=new Date(R[Q].fecha_fin);R[Q].status=""+R[Q].status}q.proyectos=R}})}}if(P=="administracion/cambios.html"){i.getCambios(function(R){console.log(R);for(var Q=0;Q<R.length;Q++){if(R[Q].fotos!="[]"){R[Q].fotos=JSON.parse(R[Q].fotos)}}q.cambios=R})}if(P=="administracion/categorias.html"){B.get(function(Q){q.categorias=Q;q.categoria.categoria_id=-1});B.getByParams("parent_id","-1","true",function(Q){q.padres=Q})}if(P=="administracion/donaciones.html"){p.get(-1,function(Q){q.donaciones=Q})}});function t(){q.validation=false;E(function(){q.validation=true},1)}function x(P){g.broadcast();q.usuario=angular.copy(P);q.usuario.rol_id=""+q.usuario.rol_id;q.usuario.calle=""+q.usuario.direcciones[0].calle;var O=angular.element(document.querySelector("#nombre"))}function k(){q.usuario={cliente_id:-1,nombre:"",apellido:"",nro_doc:"",telefono:"",password:"",direccion:"",mail:"",rol_id:"0"};g.broadcast()}function n(){}function K(){var O=confirm("Realmente desea eliminar el usuario? Esta operación no se puede deshacer");if(!O){return}q.usuario.marcado=1;N.update(q.usuario,function(P){N.getByParams("marcado","0","true",function(Q){q.usuarios=Q;k();t()})})}function j(){if(q.user.data.rol!=0){q.usuario.rol_id=q.user.data.rol}if(q.usuario.usuario_id==-1){return}N.update(q.usuario,function(O){if(q.user.data.rol==0){N.getByParams("marcado","0","true",function(P){q.usuarios=P;k();t();e.showMessage("success","Datos Guardados con Éxito")})}else{q.usuario.password="";N.setLogged(q.usuario);e.showMessage("success","Datos Guardados con Éxito")}})}function f(P){g.broadcast();q.proyecto=angular.copy(P);q.proyecto.en_slider=""+q.proyecto.en_slider;q.proyecto_categoria=q.proyecto.categoria_id;var O=angular.element(document.querySelector("#nombre"));q.foto_01=(q.proyecto.fotos[0]!=undefined)?q.proyecto.fotos[0].nombre:"no_image.png";q.foto_02=(q.proyecto.fotos[1]!=undefined)?q.proyecto.fotos[1].nombre:"no_image.png";q.foto_03=(q.proyecto.fotos[2]!=undefined)?q.proyecto.fotos[2].nombre:"no_image.png";q.foto_04=(q.proyecto.fotos[3]!=undefined)?q.proyecto.fotos[3].nombre:"no_image.png";O[0].focus();q.proyecto_categoria=q.proyecto.categoria_id}function C(){q.proyecto={cliente_id:-1,nombre:"",apellido:"",nro_doc:"",telefono:"",password:"",direccion:"",mail:"",rol_id:"0"};q.foto_01="no_image.png";q.foto_02="no_image.png";q.foto_03="no_image.png";q.foto_04="no_image.png";q.showJustificaciones=false}function s(){if(q.proyecto.proyecto_id==-1){e.showMessage("error","Debe seleccionar un proyecto");return}var O=confirm("Realmente desea eliminar el proyecto?");if(!O){return}i.removeProyecto(q.proyecto.cliente_id,function(P){i.get(function(Q){q.proyectos=Q})})}function H(){var P="[";for(var O=0;O<q.proyecto.fotos.length;O++){P=P+'{"main":"0","nombre":"'+q.proyecto.fotos[O].nombre+'","folder":"","proyecto_id":"'+q.proyecto.proyecto_id+'"},'}P=P.substring(0,P.length-1);P=P+"]";q.proyecto.fotos=P;q.proyecto.fecha_fin=new Date((q.proyecto.fecha_fin.getMonth()+1)+"/"+(q.proyecto.fecha_fin.getDate())+"/"+q.proyecto.fecha_fin.getFullYear());q.proyecto.status_cambio=1;q.proyecto.usuario_id=q.user.data.id;q.proyecto.categorias=q.proyecto_categoria;i.createCambio(q.proyecto,function(Q){console.log(Q);v.uploadsList=[];q.proyecto={proyecto_id:-1};q.showJustificaciones=false;t();L.sendMail(q.user.data.mail,[{mail:"arielcessario@gmail.com"}],"MPE","CREACIÓN DE CAMBIO - Proyecto "+q.proyecto.nombre,"Existe un nuevo cambio para aprobar",function(R){console.log(R)})})}function F(){q.proyecto.fotos=[{main:0,nombre:q.foto_01,carpeta:"",proyecto_id:-1},{main:0,nombre:q.foto_02,carpeta:"",proyecto_id:-1},{main:0,nombre:q.foto_03,carpeta:"",proyecto_id:-1},{main:0,nombre:q.foto_04,carpeta:"",proyecto_id:-1}];q.proyecto.categorias=[{categoria_id:q.proyecto_categoria}];q.proyecto.fecha_fin=new Date((q.proyecto.fecha_fin.getMonth()+1)+"/"+(q.proyecto.fecha_fin.getDate())+"/"+q.proyecto.fecha_fin.getFullYear());q.proyecto.usuario_id=q.user.data.id;if(q.proyecto.proyecto_id!=-1){q.showJustificaciones=true;return}i.create(q.proyecto,function(O){if(q.user.data.rol=="0"){i.get(function(P){q.proyectos=P;v.uploadsList=[];q.proyecto={proyecto_id:-1};t()})}else{i.getByParams("usuario_id",""+q.user.data.id,"true",function(Q){if(Q.length>0){for(var P=0;P<Q.length;P++){Q[P].costo_inicial=parseFloat(Q[P].costo_inicial);Q[P].total_donado=parseFloat(Q[P].total_donado);Q[P].fecha_inicio=new Date(Q[P].fecha_inicio);Q[P].fecha_fin=new Date(Q[P].fecha_fin);Q[P].status=""+Q[P].status}q.proyectos=Q;q.proyecto={proyecto_id:-1}}t()})}})}function D(O,Q,P){o.addImages(O,Q,P,function(S){for(var R=0;R<v.uploadsList.length;R++){if(v.uploadsList[R].id==1){q.foto_01=v.uploadsList[R].file.name}if(v.uploadsList[R].id==2){q.foto_02=v.uploadsList[R].file.name}if(v.uploadsList[R].id==3){q.foto_03=v.uploadsList[R].file.name}if(v.uploadsList[R].id==4){q.foto_04=v.uploadsList[R].file.name}}m.$apply()})}function A(O){q.proyecto_modificado=O;i.getByParams("proyecto_id",""+O.proyecto_id,""+true,function(P){q.proyecto_original=P[0];console.log(q.user.data.mail)})}function u(){q.proyecto_modificado.status_cambio=2;q.proyecto_modificado.categorias=[{categoria_id:q.proyecto_modificado.categorias}];console.log(q.proyecto_modificado);i.updateCambio(q.proyecto_modificado,function(O){if(O!=-1){i.update(q.proyecto_modificado,function(P){i.getCambios(function(Q){L.sendMail(q.user.data.mail,[{mail:q.proyecto_original.mail}],"MPE","CONFIRMACIÓN DE CAMBIO - Proyecto "+q.proyecto.nombre,"Su cambio ha sido aprobado",function(R){console.log(R)});q.cambios=Q;q.proyecto_original={};q.proyecto_modificado={};t()})})}})}function I(){q.proyecto_modificado.status_cambio=0;i.updateCambio(q.proyecto_modificado,function(O){i.getCambios(function(P){L.sendMail(q.user.data.mail,[{mail:q.proyecto_original.mail}],"MPE","CANCELACIÓN DE CAMBIO - Proyecto "+q.proyecto.nombre,"Su cambio ha sido cancelado",function(Q){console.log(Q)});q.cambios=P;q.proyecto_original={};q.proyecto_modificado={};t()})})}function z(){var O=confirm("Realmente desea eliminar la categoria? Esta operación no tiene deshacer.");if(O){B.remove(q.id,function(P){})}}function r(P){q.categoria=angular.copy(P);var O=angular.element(document.querySelector("#nombre-categoria"));O[0].focus()}function J(){if(q.categoria.parent_id==undefined){q.categoria.parent_id=-1}if(q.categoria.categoria_id!=-1){B.update(q.categoria,function(O){if(O=="true"){B.get(function(P){q.categorias=P;t()});B.getByParams("parent_id","-1","true",function(P){q.padres=P;t()})}else{}})}else{B.create(q.categoria,function(O){B.get(function(P){q.categorias=P;t()});B.getByParams("parent_id","-1","true",function(P){q.padres=P;t()})})}q.categoria={};q.categoria.categoria_id=-1}function h(O){if(!q.user){G.path("/ingreso");return}O.status=1;p.update(O,function(P){L.sendMail("arielcessario@gmail.com",[{mail:"arielcessario@gmail.com"}],"Ariel","PRUEBA","PRUEBA DE CONFIRMACIÓN DE DONACIÓN",function(R,Q){console.log(R);console.log(Q)});p.get(-1,function(Q){q.donaciones=Q})})}function y(){q.categoria={categoria_id:-1,nombre:"",parent_id:-1}}function M(O){o.uploadImages(O.item(0),"",function(P){i.confirmarDeposito(q.proyecto.proyecto_id,O.item(0).name,function(Q){console.log(Q);i.get(function(R){q.proyectos=R})})})}}function d(){this.screen="administracion/datos.html"}})();